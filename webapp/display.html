<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<script type="text/javascript" src="lib/jquery.min.js"></script>
<script type="text/javascript" src="lib/Bacon.min.js"></script>
<script type="text/javascript" src="lib/bacon.jquery.min.js"></script>
<script src="/primus/primus.js"></script>

<body>
<ul>
    <li><input type="text" id="depth"/>m</li>
    <li><input type="text" id="heading"/>&deg;</li>
    <li><input type="text" id="speed"/>kn</li>
    <li><input type="text" id="lat"/>&deg; <input type="text" id="lon"/>&deg;</li>
</ul>
</body>
<script>
    var primus = Primus.connect("http://" + window.location.host + "/?gaugedata=true",
            {reconnect: {
                maxDelay: 60000,
                minDelay: 500,
                retries: Infinity
            }});

    var depthModel = Bacon.$.textFieldValue($("#depth"));
    var depthStream = new Bacon.Bus();
    depthModel.addSource(depthStream);

    var headingModel = Bacon.$.textFieldValue($("#heading"));
    var headingStream = new Bacon.Bus();
    headingModel.addSource(headingStream);

    var speedModel = Bacon.$.textFieldValue($("#speed"));
    var speedStream = new Bacon.Bus();
    speedModel.addSource(speedStream);

    var latModel = Bacon.$.textFieldValue($("#lat"));
    var latStream = new Bacon.Bus();
    latModel.addSource(latStream);

    var lonModel = Bacon.$.textFieldValue($("#lon"));
    var lonStream = new Bacon.Bus();
    lonModel.addSource(lonStream);


    primus.on('data', function message(data) {
        switch (data.type) {
            case 'depth':
                depthStream.push(data.depth);
                break;
            case 'course':
                headingStream.push(data.heading);
                break;
            case 'speed':
                speedStream.push(data.knots);
            case 'position':
                latStream.push(data.lat);
                lonStream.push(data.lon);
                break;
        }
    });
</script>
</html>