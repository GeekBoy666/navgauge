<!DOCTYPE html>
<html >
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Gauges</title>

<script src="lib/tween-min.js"></script>
<script src="lib/steelseries-min.js"></script>
<script src="lib/Bacon.js"></script>
<script src="primus/primus.js"></script>    
</head>
<body onload="init();" style="background-color:#black">

<canvas id="speedCanvas" width="25%" height="25%"></canvas>





<script>
var speed;
    function init() {
        var sections = [steelseries.Section(0, 25, 'rgba(0, 0, 220, 0.3)'),
                        steelseries.Section(25, 50, 'rgba(0, 220, 0, 0.3)'),
                        steelseries.Section(50, 75, 'rgba(220, 220, 0, 0.3)') ],

            areas = [steelseries.Section(75, 100, 'rgba(220, 0, 0, 0.3)')],

            valGrad = new steelseries.gradientWrapper(  0,
                                                        100,
                                                        [ 0, 0.33, 0.66, 0.85, 1],
                                                        [ new steelseries.rgbaColor(0, 0, 200, 1),
                                                          new steelseries.rgbaColor(0, 200, 0, 1),
                                                          new steelseries.rgbaColor(200, 200, 0, 1),
                                                          new steelseries.rgbaColor(200, 0, 0, 1),
                                                          new steelseries.rgbaColor(200, 0, 0, 1) ]);



         speed = new steelseries.Radial('speedCanvas', {
                            gaugeType: steelseries.GaugeType.TYPE3,
                            size: 400,
                            area: areas,
                            titleString: "SOG",
                            unitString: "knots",
                            lcdVisible: true,
                            maxValue:10,
                            maxMeasuredValue:0,
                            maxMeasuredValueVisible:true,
                            thresholdVisible:false,
                            ledVisible:false,
                            pointerType:5
                        });
    }


  var gaugePrimus = Primus.connect("http://" + window.location.host + "/?gaugedata=true",
      {reconnect: {
        maxDelay: 15000,
        minDelay: 500,
        retries: Infinity
      }});

  var gaugeData = new Bacon.Bus();
  gaugePrimus.on('data', function (msg) {
       switch (msg.type) {
      case 'depth':
        break;
      case 'course':
        break;
      case 'speed':
        speed.setValueAnimated(msg.knots.toFixed(1));
        break;
  }
  gaugeData.push(msg);
  });

gaugeData.filter(function(msg){msg.type === 'speed'}).scan(0, function(old, incoming) {incoming .knots> old ? incoming.knots : old}).changes().onValue(
    function(value) {
speed.setMaxMeasuredValue(value);        
    });
</script>
</body>
</html>
